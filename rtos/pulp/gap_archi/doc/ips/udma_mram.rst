.. 
   Input file: fe/ips/udma/udma_mram/README.md

Register map
^^^^^^^^^^^^


Overview
""""""""


Refer to :ref:`GAP9 address map<REF_MEMORY_MAP_DETAIL>` for the base address to be used.

.. table:: 
    :align: center
    :widths: 40 12 12 90

    +----------------------------------------+------+-----+-------------------------------+
    |                  Name                  |Offset|Width|          Description          |
    +========================================+======+=====+===============================+
    |:ref:`RX_DEST<udma_mram__RX_DEST>`      |     0|   32|Stream ID for the uDMA channel |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`TX_DEST<udma_mram__TX_DEST>`      |     4|   32|Stream ID for the uDMA channel |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`TRANS_MODE<udma_mram__TRANS_MODE>`|     8|   32|Configure transaction mode     |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`TRANS_ADDR<udma_mram__TRANS_ADDR>`|    12|   32|Configure each transaction addr|
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`TRANS_SIZE<udma_mram__TRANS_SIZE>`|    16|   32|Configure each transaction size|
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`TRANS_CFG<udma_mram__TRANS_CFG>`  |    20|   32|Start  each transaction rx/tx  |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`EXT_ADDR<udma_mram__EXT_ADDR>`    |    24|   32|Memory access address register.|
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`STATUS<udma_mram__STATUS>`        |    28|   32|MRAM status register.          |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`MODE<udma_mram__MODE>`            |    32|   32|MRAM mode configure register.  |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`ERASE_ADDR<udma_mram__ERASE_ADDR>`|    36|   32|Erase address register.        |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`ERASE_SIZE<udma_mram__ERASE_SIZE>`|    40|   32|Erase size register.           |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`CLK_DIV<udma_mram__CLK_DIV>`      |    44|   32|Clock divide.                  |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`ISR<udma_mram__ISR>`              |    48|   32|IRQ status register.           |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`IER<udma_mram__IER>`              |    52|   32|IRQ enable register.           |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`LINE_2D<udma_mram__LINE_2D>`      |    60|   32|OSPI 2D line.                  |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`STRIDE_2D<udma_mram__STRIDE_2D>`  |    64|   32|OSPI 2D stride.                |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`ENABLE_2D<udma_mram__ENABLE_2D>`  |    68|   32|2D mode enable.                |
    +----------------------------------------+------+-----+-------------------------------+
    |:ref:`TIMING_CFG<udma_mram__TIMING_CFG>`|    72|   32|Timing configuration.          |
    +----------------------------------------+------+-----+-------------------------------+

.. _udma_mram__RX_DEST:

RX_DEST
"""""""

Stream ID for the uDMA channel

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----+-----+--------------------------------------------------------------------+
    |Bit #|R/W|Name|Reset|                            Description                             |
    +=====+===+====+=====+====================================================================+
    |7:0  |R/W|DEST|0xFF |Stream ID for the RX and TX uDMA channel. Default is 0xFF  disabled)|
    +-----+---+----+-----+--------------------------------------------------------------------+

.. _udma_mram__TX_DEST:

TX_DEST
"""""""

Stream ID for the uDMA channel

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----+-----+--------------------------------------------------------------+
    |Bit #|R/W|Name|Reset|                         Description                          |
    +=====+===+====+=====+==============================================================+
    |7:0  |R/W|DEST|0xFF |Stream ID for the CMD uDMA channel. Default is 0xFF (disabled)|
    +-----+---+----+-----+--------------------------------------------------------------+

.. _udma_mram__TRANS_MODE:

TRANS_MODE
""""""""""

Configure transaction mode

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+---------------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |Bit #|R/W|     Name      |Reset|                                                                                       Description                                                                                       |
    +=====+===+===============+=====+=========================================================================================================================================================================================+
    |    0|R/W|AUTO_ENA       |0x0  |Set transfer mode in AUTO, in which MRAM interface configures the UDMA transfer automatically using register parameters instead using SW configuration of UDMA: b0: disabled; b1: enabled|
    +-----+---+---------------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    1|R/W|XIP_EN         |0x0  |Transfer mode in XIP, IP will configure the UDMA transfer automatically using XIP parameters instead using SW configuration in UDMA: b0: XIP_DIS; b1: XIP_EN                             |
    +-----+---+---------------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |3:2  |R  |RESERVED       |0x0  |--                                                                                                                                                                                       |
    +-----+---+---------------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    4|R/W|XIP_HALTED     |0x0  |Halted XIP refill when in XIP, XIP refill will wait until SW unlocks this bit: b0: XIP_RUNNING; b1: XIP_HALTED                                                                           |
    +-----+---+---------------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    5|R/W|XIP_AUTO_HALTED|0x0  |XIP refills will be automatically blocked when an erase operation is on-going: b0: disabled; b1: enabled                                                                                 |
    +-----+---+---------------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _udma_mram__TRANS_ADDR:

TRANS_ADDR
""""""""""

Configure each transaction addr

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----+-----+----------------------------------------+
    |Bit #|R/W|Name|Reset|              Description               |
    +=====+===+====+=====+========================================+
    |31:0 |R/W|ADDR|0x0  |Transfer addr, only when MODE is in AUTO|
    +-----+---+----+-----+----------------------------------------+

.. _udma_mram__TRANS_SIZE:

TRANS_SIZE
""""""""""

Configure each transaction size

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----+-----+-------------+
    |Bit #|R/W|Name|Reset| Description |
    +=====+===+====+=====+=============+
    |20:0 |R/W|SIZE|0x0  |Transfer Size|
    +-----+---+----+-----+-------------+

.. _udma_mram__TRANS_CFG:

TRANS_CFG
"""""""""

Start  each transaction rx/tx

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+-----+-----+---------------------------------------------------------------------------------------+
    |Bit #|R/W|Name |Reset|                                      Description                                      |
    +=====+===+=====+=====+=======================================================================================+
    |    0|R/W|RXTX |0x0  |Transfer type: b0: TX; b1: RX                                                          |
    +-----+---+-----+-----+---------------------------------------------------------------------------------------+
    |    1|R/W|VALID|0x0  |Transfer valid to start: b0: clear transfer; b1: Start transfer. Read always returns O.|
    +-----+---+-----+-----+---------------------------------------------------------------------------------------+

.. _udma_mram__EXT_ADDR:

EXT_ADDR
""""""""

Memory access address register.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----+-----+-------------------------------+
    |Bit #|R/W|Name|Reset|          Description          |
    +=====+===+====+=====+===============================+
    |31:0 |R/W|ADDR|0x0  |Memory access address bitfield.|
    +-----+---+----+-----+-------------------------------+

.. _udma_mram__STATUS:

STATUS
""""""

MRAM status register.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |Bit #|R/W|   Name   |Reset|                                                                            Description                                                                             |
    +=====+===+==========+=====+====================================================================================================================================================================+
    |    0|R  |ERASE_BUSY|0x0  |Erase busy: b0: not busy; b1: busy                                                                                                                                  |
    +-----+---+----------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    1|R  |TX_BUSY   |0x0  |TX busy: b0: not busy; b1: busy                                                                                                                                     |
    +-----+---+----------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    2|R  |RX_BUSY   |0x0  |RX busy: b0: not busy; b1: busy                                                                                                                                     |
    +-----+---+----------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    3|R  |RESERVED  |0x0  |--                                                                                                                                                                  |
    +-----+---+----------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    4|R  |UE_ERR    |0x0  |Unrecoverable Error, High indicates unrecoverable errors detected. Not 100% accurate for 3 or more bit errors. In the case of 3-bit errors, correct detection is 84%|
    +-----+---+----------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    5|R  |EC_ERR    |0x0  |ECC Error Correction, Low indicates no ECC error detected. High indicates 1- or 2-bit errors corrected.                                                             |
    +-----+---+----------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _udma_mram__MODE:

MODE
""""

MRAM mode configure register.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |Bit #|R/W|  Name   |Reset|                                                                         Description                                                                          |
    +=====+===+=========+=====+==============================================================================================================================================================+
    |    0|R/W|ECCBYPS  |0x0  |Signal ECC bypass                                                                                                                                             |
    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    1|R/W|DPD      |0x0  |Signal Deep power down                                                                                                                                        |
    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    3|R/W|TMEN     |0x0  |Signal TMEN                                                                                                                                                   |
    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    4|R/W|NVR      |0x0  |Signal NVR                                                                                                                                                    |
    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    5|R/W|RSTb     |0x0  |Signal RSTb                                                                                                                                                   |
    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    6|R/W|RETb     |0x0  |Signal RETb                                                                                                                                                   |
    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |    7|R/W|PORb     |0x0  |Signal PORb                                                                                                                                                   |
    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+
    |15:8 |R/W|OPERATION|0x0  |Configure MRAM operation: h00: power up; h01: configure trimming; h02: program; h04: chip erase; h08: sector erase; h10 word erase; h20: power down; h40: read|
    +-----+---+---------+-----+--------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. _udma_mram__ERASE_ADDR:

ERASE_ADDR
""""""""""

Erase address register.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+--------+-----+----------------------------------+
    |Bit #|R/W|  Name  |Reset|           Description            |
    +=====+===+========+=====+==================================+
    |3:0  |R/W|ADDR_LSB|0x0  |Erase addr, lower 4 bit is useless|
    +-----+---+--------+-----+----------------------------------+
    |20:4 |R/W|ADDR_MSB|0x0  |Erase addr                        |
    +-----+---+--------+-----+----------------------------------+

.. _udma_mram__ERASE_SIZE:

ERASE_SIZE
""""""""""

Erase size register.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----+-----+-----------+
    |Bit #|R/W|Name|Reset|Description|
    +=====+===+====+=====+===========+
    |6:0  |R/W|SIZE|0x0  |Erase Size |
    +-----+---+----+-----+-----------+

.. _udma_mram__CLK_DIV:

CLK_DIV
"""""""

Clock divide.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------+
    |Bit #|R/W| Name |Reset|                                                                     Description                                                                     |
    +=====+===+======+=====+=====================================================================================================================================================+
    |7:0  |R/W|DATA  |0x0  |Clock divider ratio (0-255): PERIPH clock frequency is divided by pow2(DATA)                                                                         |
    +-----+---+------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------+
    |8    |W  |VALID |0x0  |Clock divider valid, user cannot control. Every time there is clock divide write access, set 1 by default, then when clock divide is finished, set 0.|
    +-----+---+------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------+
    |9    |W  |ENABLE|0x0  |MRAM Clock enable.                                                                                                                                   |
    +-----+---+------+-----+-----------------------------------------------------------------------------------------------------------------------------------------------------+

.. _udma_mram__ISR:

ISR
"""

IRQ status register.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----------------+-----+-----------------------+
    |Bit #|R/W|      Name      |Reset|      Description      |
    +=====+===+================+=====+=======================+
    |    0|R  |erase_done      |0x0  |MRAM erase finish      |
    +-----+---+----------------+-----+-----------------------+
    |    1|R  |program_done    |0x0  |MRAM program finish    |
    +-----+---+----------------+-----+-----------------------+
    |    2|R  |trim_config_done|0x0  |MRAM trim config finish|
    +-----+---+----------------+-----+-----------------------+
    |    3|R  |rx_done         |0x0  |MRAM read finish.      |
    +-----+---+----------------+-----+-----------------------+

.. _udma_mram__IER:

IER
"""

IRQ enable register.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+------------------+-----+-------------------------------+
    |Bit #|R/W|       Name       |Reset|          Description          |
    +=====+===+==================+=====+===============================+
    |    0|R/W|erase_en          |0x0  |MRAM erase IRQ enable          |
    +-----+---+------------------+-----+-------------------------------+
    |    1|R/W|program_en        |0x0  |MRAM program IRQ enable        |
    +-----+---+------------------+-----+-------------------------------+
    |    2|R/W|trim_config_en    |0x0  |MRAM trim config IRQ enable    |
    +-----+---+------------------+-----+-------------------------------+
    |    3|R/W|rx_done_en        |0x0  |MRAM read IRQ enable.          |
    +-----+---+------------------+-----+-------------------------------+
    |    4|R/W|xip_erase_en      |0x0  |MRAM XIP erase IRQ enable      |
    +-----+---+------------------+-----+-------------------------------+
    |    5|R/W|xip_program_en    |0x0  |MRAM XIP program IRQ enable    |
    +-----+---+------------------+-----+-------------------------------+
    |    6|R/W|xip_trim_config_en|0x0  |MRAM XIP trim config IRQ enable|
    +-----+---+------------------+-----+-------------------------------+
    |    7|R/W|rx_xip_done_en    |0x0  |MRAM XIP read IRQ enable.      |
    +-----+---+------------------+-----+-------------------------------+

.. _udma_mram__LINE_2D:

LINE_2D
"""""""

OSPI 2D line.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+----+-----+-----------------------------------------------------------------------------------------------------------+
    |Bit #|R/W|Name|Reset|                                                Description                                                |
    +=====+===+====+=====+===========================================================================================================+
    |31:0 |R/W|LINE|0x0  |OSPI 2D line with 2D mode. For example, ADDR = START_ADDR + i * BURST_STRIDE. Normally, LINE >= BURST_SIZE.|
    +-----+---+----+-----+-----------------------------------------------------------------------------------------------------------+

.. _udma_mram__STRIDE_2D:

STRIDE_2D
"""""""""

OSPI 2D stride.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+------+-----+---------------------------------------------------------------------------------------------------------------+
    |Bit #|R/W| Name |Reset|                                                  Description                                                  |
    +=====+===+======+=====+===============================================================================================================+
    |31:0 |R/W|STRIDE|0x0  |OSPI 2D stride with 2D mode. For example, ADDR = START_ADDR + i * BURST_STRIDE. Normally, STRIDE >= BURST_SIZE.|
    +-----+---+------+-----+---------------------------------------------------------------------------------------------------------------+

.. _udma_mram__ENABLE_2D:

ENABLE_2D
"""""""""

2D mode enable.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+------+-----+-------------------------------------------------------------+
    |Bit #|R/W| Name |Reset|                         Description                         |
    +=====+===+======+=====+=============================================================+
    |    0|R/W|ENABLE|0x0  |MRAM 2D mode enable: b0: 2D mode disable; b1: 2D mode disable|
    +-----+---+------+-----+-------------------------------------------------------------+

.. _udma_mram__TIMING_CFG:

TIMING_CFG
""""""""""

Timing configuration.

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+---------------+-----+----------------------------------------+
    |Bit #|R/W|     Name      |Reset|              Description               |
    +=====+===+===============+=====+========================================+
    |2:0  |R/W|STROBE_TIME_CNT|0x2  |Strobe timing couner                    |
    +-----+---+---------------+-----+----------------------------------------+
    |5:3  |R/W|GO_SUP_TIME_CNT|0x4  |Power Supply timing couner              |
    +-----+---+---------------+-----+----------------------------------------+
    |8:6  |R/W|MEN_TIME_CNT   |0x4  |MRAM EN timing couner                   |
    +-----+---+---------------+-----+----------------------------------------+
    |15:9 |R/W|RW_TIME_CNT    |0x78 |Latency from write to read timing couner|
    +-----+---+---------------+-----+----------------------------------------+
    |18:16|R/W|ADS_TIME_CNT   |0x4  |Address setup time couner               |
    +-----+---+---------------+-----+----------------------------------------+
    |28:19|R/W|PGS_TIME_CNT   |0x320|Program Setup time couner               |
    +-----+---+---------------+-----+----------------------------------------+
    |31:29|R/W|PROG_TIME_CNT  |0x8  |Program Min Pulse Width timing couner   |
    +-----+---+---------------+-----+----------------------------------------+
